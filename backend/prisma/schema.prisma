generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Closing {
  id             Int              @id @default(autoincrement())
  monthId        Int
  companyId      Int?
  name           String
  startDate      DateTime?        @db.Timestamptz(6)
  endDate        DateTime?        @db.Timestamptz(6)
  status         String           @default("aberto")
  totalEntries   Float            @default(0)
  totalExpenses  Float            @default(0)
  totalTaxes     Float            @default(0)
  balance        Float            @default(0)
  profitMargin   Float            @default(0)
  createdAt      DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime         @default(now()) @db.Timestamptz(6)
  Company        Company?         @relation(fields: [companyId], references: [id], onDelete: Restrict, map: "fk_closing_company")
  Month          Month            @relation(fields: [monthId], references: [id], onDelete: Cascade, map: "fk_closing_month")
  FinancialEntry FinancialEntry[]

  @@index([companyId], map: "idx_closing_companyId")
  @@index([monthId], map: "idx_closing_monthId")
}

model Company {
  id               Int              @id @default(autoincrement())
  name             String
  type             String
  cnpj             String           @unique
  dateRegistration DateTime         @db.Timestamptz(6)
  status           String
  responsible      String
  commission       Float
  Closing          Closing[]
  FinancialEntry   FinancialEntry[]
  FinancialPeriod  FinancialPeriod[]
  Load             Load[]
}

model Employee {
  id          Int           @id @default(autoincrement())
  name        String
  role        String
  baseSalary  Float
  status      String
  cpf         String?
  phone       String?
  email       String?
  address     String?
  hireDate    DateTime      @default(now()) @db.Timestamptz(6)
  createdAt   DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime      @default(now()) @db.Timestamptz(6)
  Transaction Transaction[]
}

model FinancialEntry {
  id           Int      @id @default(autoincrement())
  description  String
  amount       Float
  category     String
  date         DateTime @db.Timestamptz(6)
  type         String
  observations String?
  closingId    Int?
  companyId    Int?
  createdAt    DateTime @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime @default(now()) @db.Timestamptz(6)
  Closing      Closing? @relation(fields: [closingId], references: [id], onDelete: Cascade, map: "fk_finEntry_closing")
  Company      Company? @relation(fields: [companyId], references: [id], onDelete: Restrict, map: "fk_finEntry_company")

  @@index([closingId], map: "idx_finEntry_closingId")
  @@index([companyId], map: "idx_finEntry_companyId")
}

model FinancialPeriod {
  id           Int       @id @default(autoincrement())
  name         String
  startDate    DateTime  @db.Timestamptz(6)
  endDate      DateTime  @db.Timestamptz(6)
  companyId    Int?
  status       String    @default("aberto")
  totalEntries Float     @default(0)
  totalExpenses Float    @default(0)
  totalTaxes   Float     @default(0)
  balance      Float     @default(0)
  profitMargin Float     @default(0)
  createdAt    DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime  @default(now()) @db.Timestamptz(6)
  Company      Company?  @relation(fields: [companyId], references: [id], onDelete: Restrict, map: "fk_finPeriod_company")

  @@index([companyId], map: "idx_finPeriod_companyId")
}

model Load {
  id            Int      @id @default(autoincrement())
  date          DateTime @db.Timestamptz(6)
  loadingNumber String
  deliveries    Int
  cargoWeight   Float
  totalValue    Float
  freight4      Float
  totalFreight  Float
  closings      Float
  observations  String?
  companyId     Int
  Company       Company  @relation(fields: [companyId], references: [id], map: "fk_load_company")

  @@index([companyId], map: "idx_load_companyId")
}

model Maintenance {
  id        Int      @id @default(autoincrement())
  date      DateTime @db.Timestamptz(6)
  service   String
  km        Int
  value     Float
  notes     String?
  truckId   Int
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @db.Timestamptz(6)
  Truck     Truck    @relation(fields: [truckId], references: [id], onDelete: Cascade, map: "fk_maintenance_truck")

  @@index([truckId], map: "idx_maintenance_truckId")
}

model Month {
  id        Int       @id @default(autoincrement())
  year      Int
  month     Int
  name      String
  status    String    @default("aberto")
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime  @default(now()) @db.Timestamptz(6)
  Closing   Closing[]

  @@unique([year, month], map: "uq_month_year_month")
}

model Transaction {
  id         Int      @id @default(autoincrement())
  type       String
  amount     Float
  date       DateTime @default(now()) @db.Timestamptz(6)
  employeeId Int
  Employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade, map: "fk_transaction_employee")

  @@index([employeeId], map: "idx_transaction_employeeId")
}

model Trip {
  id           Int           @id @default(autoincrement())
  destination  String
  driver       String
  date         DateTime      @db.Timestamptz(6)
  freightValue Float
  status       String        @default("em_andamento")
  notes        String?
  truckId      Int?
  createdAt    DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime      @default(now()) @db.Timestamptz(6)
  Truck        Truck?        @relation(fields: [truckId], references: [id], onDelete: Restrict, map: "fk_trip_truck")
  TripExpense  TripExpense[]

  @@index([truckId], map: "idx_trip_truckId")
}

model TripExpense {
  id          Int      @id @default(autoincrement())
  description String
  amount      Float
  date        DateTime @db.Timestamptz(6)
  category    String
  notes       String?
  tripId      Int
  createdAt   DateTime @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime @default(now()) @db.Timestamptz(6)
  Trip        Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade, map: "fk_tripExpense_trip")

  @@index([tripId], map: "idx_tripExpense_tripId")
}

model Truck {
  id          Int           @id @default(autoincrement())
  name        String
  plate       String        @unique
  brand       String
  year        Int
  docExpiry   DateTime      @db.Timestamptz(6)
  renavam     String
  image       String?
  Maintenance Maintenance[]
  Trip        Trip[]
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  phone     String?
  address   String?
  createdAt DateTime @default(now()) @db.Timestamptz(6)
}
